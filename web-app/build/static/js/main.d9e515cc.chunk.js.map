{"version":3,"sources":["hooks/useLocationPermission.js","App.js","index.js"],"names":["useLocationPermission","hasPermission","setHasPermission","useState","useEffect","checkPermission","async","result","navigator","permissions","query","name","state","addEventListener","error","console","requestPermission","geolocation","getCurrentPosition","enableHighAccuracy","App","location","setLocation","partnerLocation","setPartnerLocation","message","setMessage","isConnected","setIsConnected","setError","ws","useRef","userId","concat","Math","random","toString","substr","setupLocationTracking","setupWebSocket","current","close","WebSocket","onopen","send","JSON","stringify","type","onclose","setTimeout","onmessage","event","data","parse","watchPosition","position","newLocation","latitude","coords","longitude","accuracy","readyState","OPEN","maximumAge","timeout","React","createElement","className","Fragment","toFixed","value","onChange","e","target","placeholder","onClick","sendMessage","_ws$current","trim","text","ReactDOM","createRoot","document","getElementById","render","StrictMode"],"mappings":"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","file":"static/js/main.d9e515cc.chunk.js","sourcesContent":["// web-app/src/hooks/useLocationPermission.js\r\nimport { useState, useEffect } from 'react';\r\n\r\nexport const useLocationPermission = () => {\r\n  const [hasPermission, setHasPermission] = useState(false);\r\n\r\n  useEffect(() => {\r\n    checkPermission();\r\n  }, []);\r\n\r\n  const checkPermission = async () => {\r\n    try {\r\n      const result = await navigator.permissions.query({ name: 'geolocation' });\r\n      setHasPermission(result.state === 'granted');\r\n      \r\n      result.addEventListener('change', () => {\r\n        setHasPermission(result.state === 'granted');\r\n      });\r\n    } catch (error) {\r\n      console.error('Error checking permission:', error);\r\n    }\r\n  };\r\n\r\n  const requestPermission = () => {\r\n    navigator.geolocation.getCurrentPosition(\r\n      () => setHasPermission(true),\r\n      () => setHasPermission(false),\r\n      { enableHighAccuracy: true }\r\n    );\r\n  };\r\n\r\n  return { hasPermission, requestPermission };\r\n};","// web-app/src/App.js\r\nimport React, { useState, useEffect, useRef } from 'react';\r\nimport { useLocationPermission } from './hooks/useLocationPermission';\r\n\r\nfunction App() {\r\n  const [location, setLocation] = useState(null);\r\n  const [partnerLocation, setPartnerLocation] = useState(null);\r\n  const [message, setMessage] = useState('');\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const ws = useRef(null);\r\n  const userId = useRef(`web-${Math.random().toString(36).substr(2, 9)}`);\r\n  const { hasPermission, requestPermission } = useLocationPermission();\r\n  \r\n  useEffect(() => {\r\n    if (hasPermission) {\r\n      setupLocationTracking();\r\n    }\r\n  }, [hasPermission]);\r\n\r\n  useEffect(() => {\r\n    setupWebSocket();\r\n    return () => {\r\n      if (ws.current) {\r\n        ws.current.close();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const setupWebSocket = () => {\r\n    ws.current = new WebSocket('wss://location-share-ww81.onrender.com');\r\n    \r\n    ws.current.onopen = () => {\r\n      setIsConnected(true);\r\n      ws.current.send(JSON.stringify({\r\n        type: 'register',\r\n        userId: userId.current\r\n      }));\r\n    };\r\n\r\n    ws.current.onclose = () => {\r\n      setIsConnected(false);\r\n      setTimeout(setupWebSocket, 3000); // Reconnect attempt\r\n    };\r\n\r\n    ws.current.onmessage = (event) => {\r\n      const data = JSON.parse(event.data);\r\n      if (data.type === 'location') {\r\n        setPartnerLocation(data.location);\r\n      }\r\n    };\r\n  };\r\n\r\n  const setupLocationTracking = () => {\r\n    if (!navigator.geolocation) {\r\n      setError('Geolocation is not supported by your browser');\r\n      return;\r\n    }\r\n\r\n    navigator.geolocation.watchPosition(\r\n      (position) => {\r\n        const newLocation = {\r\n          latitude: position.coords.latitude,\r\n          longitude: position.coords.longitude,\r\n          accuracy: position.coords.accuracy,\r\n        };\r\n        setLocation(newLocation);\r\n        \r\n        if (ws.current && ws.current.readyState === WebSocket.OPEN) {\r\n          ws.current.send(JSON.stringify({\r\n            type: 'location',\r\n            userId: userId.current,\r\n            location: newLocation\r\n          }));\r\n        }\r\n      },\r\n      (error) => {\r\n        setError(`Error getting location: ${error.message}`);\r\n      },\r\n      {\r\n        enableHighAccuracy: true,\r\n        maximumAge: 0,\r\n        timeout: 5000\r\n      }\r\n    );\r\n  };\r\n\r\n  const sendMessage = () => {\r\n    if (message.trim() && ws.current?.readyState === WebSocket.OPEN) {\r\n      ws.current.send(JSON.stringify({\r\n        type: 'message',\r\n        userId: userId.current,\r\n        text: message\r\n      }));\r\n      setMessage('');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-900 text-white p-4\">\r\n      <div className=\"max-w-md mx-auto space-y-4\">\r\n        {!hasPermission ? (\r\n          <button\r\n            onClick={requestPermission}\r\n            className=\"w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg\"\r\n          >\r\n            Enable Location Sharing\r\n          </button>\r\n        ) : (\r\n          <>\r\n            <div className=\"bg-gray-800 p-4 rounded-lg\">\r\n              <h2 className=\"text-lg font-semibold mb-2\">Status</h2>\r\n              <p className=\"text-sm\">\r\n                Connection: {isConnected ? (\r\n                  <span className=\"text-green-500\">Connected</span>\r\n                ) : (\r\n                  <span className=\"text-red-500\">Disconnected</span>\r\n                )}\r\n              </p>\r\n              {location && (\r\n                <p className=\"text-sm\">\r\n                  Your location: {location.latitude.toFixed(6)}, {location.longitude.toFixed(6)}\r\n                </p>\r\n              )}\r\n              {partnerLocation && (\r\n                <p className=\"text-sm\">\r\n                  Partner location: {partnerLocation.latitude.toFixed(6)}, {partnerLocation.longitude.toFixed(6)}\r\n                </p>\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"flex gap-2\">\r\n              <input\r\n                type=\"text\"\r\n                value={message}\r\n                onChange={(e) => setMessage(e.target.value)}\r\n                className=\"flex-1 bg-gray-800 text-white px-4 py-2 rounded-lg\"\r\n                placeholder=\"Type emergency message...\"\r\n              />\r\n              <button\r\n                onClick={sendMessage}\r\n                className=\"bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg\"\r\n              >\r\n                Send\r\n              </button>\r\n            </div>\r\n          </>\r\n        )}\r\n        \r\n        {error && (\r\n          <div className=\"bg-red-900/50 border border-red-500 p-4 rounded-lg\">\r\n            {error}\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;","import React from 'react';\r\nimport ReactDOM from 'react-dom/client';\r\nimport './index.css';\r\nimport App from './App';\r\n\r\nconst root = ReactDOM.createRoot(document.getElementById('root'));\r\nroot.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>\r\n);"],"sourceRoot":""}